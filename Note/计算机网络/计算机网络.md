# 计算机网络

## 1.我们的底层链路最终是通过 MAC 地址找到目标主机的，那么 IP 如何转换成 MAC 地址？

ARP 协议，当一台计算机知道目标主机的 IP 地址，而不知道其 MAC 地址时，会通过 ARP 请求广播到网络中：

1. 此时会像当前局域网广播一个 ARP 包，询问谁拥有这个 IP 地址？
2. 目标主机收到请求后，会发送一个 ARP 响应包，里面包含他的 MAC 地址。
3. 发送者收到 ARP 响应后，会将目标主机的 IP 地址和 MAC 地址存入 ARP 缓存。

ARP 协议并不基于任何协议，它属于数据链路层协议，当需要跨网络（不在同一局域网内），路由器会先根据目标 IP 地址进行路由选择。

## 2. 键入网址到页面显示发生了什么？

1. 第一步是解析 URL，**生成**我们需要发送给 web 服务器的请求信息，相当于输入（input），比如协议，web 服务器（地址），路径，文件等。

2. 此时我们得到了 web 服务器地址，比如说 www.baidu.com 这样的地址，我们需要将他解析成 IP 地址才可以去进行访问，我们本机虽然会有缓存，但是肯定无法存储所有域名对应的 IP 地址，此时就需要去向专门的 DNS 服务器去查询指定域名的服务器地址。

   此时额外需要注意的就是我们的域名以 `.` 分割，这就代表了层级，先向根 DNS 服务器查询 `.com` 的地址，再去 `.com` 服务器查询 `.baidu` 的地址，这样最终就找到了我们想要访问的服务器的地址。

3. http 调用套接字，通过 tcp 实现可靠传输。

4. 将源地址，目标地址，协议号（如 TCP）填入 IP 包头，生成 IP 报文。

5. 然后我们需要加上 MAC 头部，需要将目标 MAC 地址，源 MAC 地址，协议号填入，目标地址可以通过本地的ARP 缓存表查询，如果本地没有，可以通过 ARP 协议获取目标地址的 MAC 地址。

6. 最后，包头加上起始帧分界符，包尾加上 `FCS` 帧校验序列之后，我们需要通过网卡就将一系列二进制数据转换为电信号发送出去。

7. 中途，交换机中，电信号会被转换为数字信号，校验错误，然后放入缓冲区，通过包头的目标端口转发到对应的交换机端口从而发送到链路中。

8. 经过路由器，它具有三层，具有 MAC 地址和 IP 地址，而交换机没有，所以他会对包头的 MAC 地址进行检验，不是发给自己的就丢弃，然后去掉 MAC 头部，根据 IP 头部信息进行转发。

   我们在途中每经过一个路由或者主机，都需要进行一次路由选择算法选择对应的 IP，然后通过 ARP 缓存表或者 ARP 协议获取对应 IP 的 MAC 地址，以此来转发包。

9. 到达服务器，去除一系列包头，到达应用层。

## 3. LINUX 的收发网络包

由于单纯依赖中断来检测网络数据包是否到达的效率过低，Linux 引入了 NAPI 机制，当数据包过多时，会先暂时屏蔽中断，而采用轮询的机制，定期检查是否有新数据包的到达。